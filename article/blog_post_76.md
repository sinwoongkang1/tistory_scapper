# [블로그 포스팅 Auto Push] AWS EC2

이전 포스팅의 결과로 컴퓨터를 실행하고 있으면 내가 지정한 시간에 블로그 글을 스크래핑 하고, 깃 허브에 푸쉬하는 동작들을 실습해봤다. 하지만 항상 켜있는 컴퓨터가 있다면 얼마나 편할까? 라는 생각이 가지시 않기 때문에 AWS EC2 인스턴스를 활성화 하고 해당 기능들을 실행시켜보도록 하자. 또 작성일 기준 청구금액과 월말 청구 금액또한 아라보자....
전체적인 흐름도
p.s. 작업 전에 이렇게 전체적인 흐름도를 만들고 시작하면, 내가 지금 무슨 작업을 하고 있는지 언제든지 파악이 가능하고, 어쩔 수 없이 작업이 끊기더라도 다음에 진행 상황을 파악하기 까지의 시간이 단축되는 것 같다.
1. AWS EC2 인스턴스 활성화 하기
그냥 이제 AWS 화면만 봐도 무섭다. 하지만 실험을 위해 인스턴스를 시작한다.
2. 로컬 - EC2 SSH 프로토콜 접속 및 파이썬 프로그램 전송
SSH 접속 및 파일 전송은 이전 포스팅 참고.
2025.01.23 - [네트워크 + 네트워크관리사 학습] - 🛜 [네트워크] AWS EC2 에 SSH 프로토콜로 접속 및 파일 전송하기
🛜 [네트워크] AWS EC2 에 SSH 프로토콜로 접속 및 파일 전송하기
https://cs-study1.tistory.com/56 🛜 [네트워크] SSH 프로토콜을 이용하여 랩탑으로 데스크탑에 접속하기네트워크 , 네트워크 관리사를 공부하면서 Telnet 과 (Telnet 보다) 보안이 강화된 SSH 프로토콜들에
cs-study1.tistory.com
2-1 . 로컬로 EC2에 접속한다.
2-2. EC2에도 내 로컬과 같은 폴더 구조를 만들어준다.
2-3. 파이썬 프로그램과 변수명이 저장된 txt 파일을 옮겨준다.
2-4 . EC2 에 옮겨진 것을 확인한다.
2-5. EC2 에도 파이썬 라이브러리를 설치하기 위해 가상화 폴더를 만들고 라이브러리들을 설치해준다.
라이브러리 설치는 이전 포스팅 참고
https://cs-study1.tistory.com/72
[블로그 포스팅 자동 커밋하기]
블로그에 포스팅 된 내용을 자동으로 스크랩 하여 특정 저장소에 [포스팅제목].md 파일을 생성하도록 하고,이 생성된 파일이 Github에 commit& push 되도록 셋팅 하고자 한다. 작업순서 1. 블로그의
cs-study1.tistory.com
가상화 라이브러리 설치 단계
3. 폴더를 git 레포지토리와 연결하기
생각해보니 깃 저장소의 내용을 복사해올거였으니 SSH 로 파일 옮길 필요가 없었다... ㅠㅠ
저장소를 Git 초기화 하고 origin 주소를 연결, 원격 저장소의 파일들을 pull 해온다.
이제 파이썬에 있는 내용 중 변경을 감지할 폴더를 EC2 폴더로 수정해줘야 한다.
나노 편집기로 수정한다.
주석을 달아 놓으니 IDE 환경이 아니여도 편집하기 수월하다
파일을 저장할 경로, 원격 저장소와 연결된 디렉터리 경로들을 모두 수정해주었다.
4. EC2 에서 동작 설정
로컬 리눅스에서는 crontab 을 이용하여 설정하였으므로 같은 방법을 시도해본다.
어? 왜 없지???
crontab 을 사용하기 위한 패키지를 설치해본다.
3-1 패키지 매니져를 통해 패키지를 설치
sudo yum install cronie
3-2 crond 서비스 시작하기
sudo service crond start
3-3 crontab 작성하기
crontab -e
3-4 crontab 이 잘 설정됐나 -l 옵션으로 확인할 수 있다.
파일 변경 감지 스크립트를 먼저 실행하고
블로그 내용을 스크랩 하는 스크립트를 실행, 폴더에 새로운 파일.md 로 저장
이 변경을 탐지하고 커밋 후 푸쉬
프로세스 종료
위와 같은 과정으로 진행되도록 crontab 내용을 작성하였고. EC2 의 시스템 시간과 현재 시간이 차이가 났는데, 일단은 EC2 시간으로 설정해주고, 내 현재시간으로는 20시33분에 push가 되면 성공이다.
푸쉬가 되고 알람이 도착했다!
프로세스들에서도 ChangeHandler.py 는 실행되지 않고 종료한 것을 확인할 수 있었다.
crontab 의 마지막 프로세스 종료문에서는, 여러번의 실험 중
ChangeHandler.py
가 백그라운드 프로세스로 계속 남아있는 것을 확인해서 파이프라인으로,
ChangeHandler.py
로 검색되는 프로세스는 종료하도록 설정해 주었다.
5.마무리
파일 셋팅 및 동작 설정이 간단해 보이지만, 콘솔로 작업하고 git commit 이 순환되는 오류가 생겨서 가만히 놔두니 커밋이 105 개가 추가되어서, 저번의 800 몇 개 까지 합쳐서 총 973개나 발생해버렸다. 다시 삭제하고 차근차근 절차대로 하니 다시 잘 수행되었다. 특히 crontab 을 설치하고 활성화가 안 된 상태를 확인하고, 활성화 하여 실행하는 것이 중요했다.
그리고 가장 중요한 비용을 캡쳐 해 놨다.
EC2 를 만들고 VPC가 활성화 된 것으로만으로 한달에 약 1만원을 청구하길래 그냥 나중에 공부할라고 계속 살려둔건데
이게 2월 말에 얼마나 올라가있는지 확인해보자...
하루에 1번 스크립트 실행하고, 블로그 포스팅 긁어오고, Git 에 Push 하는 3분의 시간이, 얼마나 리소스를 사용해서 비용을 청구할지 기대된다.